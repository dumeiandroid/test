<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hasil Tes Kecerdasan Majemuk</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px; 
        }
        .container { 
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }
        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }
        .content {
            padding: 40px;
        }
        .profile-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 5px solid #667eea;
        }
        .profile-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .profile-item {
            display: flex;
            flex-direction: column;
        }
        .profile-label {
            font-size: 0.85em;
            color: #667eea;
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        .profile-value {
            font-size: 1.1em;
            color: #2c3e50;
        }
        .chart-container {
            position: relative;
            height: 350px;
            margin: 30px 0;
        }
        .score-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }
        .score-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border-left: 5px solid;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        .score-card:hover {
            transform: translateY(-5px);
        }
        .score-card.dominant {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }
        .score-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .score-name {
            font-weight: bold;
            font-size: 1.1em;
        }
        .score-value {
            font-size: 1.5em;
            font-weight: bold;
        }
        .score-bar {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }
        .score-fill {
            height: 100%;
            transition: width 1s ease;
        }
        .dominant-section {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
            text-align: center;
        }
        .dominant-section h2 {
            font-size: 2em;
            margin-bottom: 15px;
        }
        .dominant-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        .dominant-badge {
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: bold;
        }
        .info-section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            border: 2px solid #e9ecef;
        }
        .info-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .intelligence-detail {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid;
        }
        .intelligence-detail h4 {
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        .intelligence-detail ul {
            list-style: none;
            padding-left: 0;
        }
        .intelligence-detail li {
            padding: 5px 0;
            padding-left: 25px;
            position: relative;
            color: #555;
        }
        .intelligence-detail li:before {
            content: "‚Ä¢";
            position: absolute;
            left: 5px;
            font-size: 1.3em;
        }
        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 30px;
        }
        button {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-download {
            background: #667eea;
            color: white;
        }
        .btn-download:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        .btn-print {
            background: #2c3e50;
            color: white;
        }
        .btn-print:hover {
            background: #1a252f;
            transform: translateY(-2px);
        }
        .error-msg {
            text-align: center;
            padding: 60px 40px;
            color: #e74c3c;
        }
        .loading {
            text-align: center;
            padding: 60px 40px;
            color: #7f8c8d;
        }
        @media print {
            body { background: white; padding: 0; }
            .button-group { display: none; }
            .container { box-shadow: none; }
        }
        @media (max-width: 600px) {
            .header h1 { font-size: 1.5em; }
            .button-group { grid-template-columns: 1fr; }
            .score-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<div class="container" id="mainContainer">
    <div class="loading">
        <div style="font-size: 3em; margin-bottom: 20px;">‚è≥</div>
        <h3>Memuat Hasil Tes Kecerdasan Majemuk...</h3>
    </div>
</div>

<script>
const INTELLIGENCES = {
    'Linguistik': {
        color: '#1abc9c',
        icon: 'üìù',
        description: 'Kecerdasan dalam menggunakan kata-kata dan bahasa',
        characteristics: [
            'Pandai berbicara dan menulis',
            'Senang membaca dan bercerita',
            'Mudah mengingat kata-kata dan informasi verbal',
            'Menikmati permainan kata dan teka-teki bahasa'
        ],
        careers: ['Penulis', 'Jurnalis', 'Pengacara', 'Guru Bahasa', 'Penyiar', 'Editor'],
        tips: [
            'Menulis jurnal atau blog',
            'Membaca berbagai jenis buku',
            'Ikut klub debat atau diskusi',
            'Belajar bahasa baru'
        ]
    },
    'Matematika Logis': {
        color: '#3498db',
        icon: 'üî¢',
        description: 'Kecerdasan dalam bernalar dan menghitung',
        characteristics: [
            'Berpikir secara logis dan analitis',
            'Senang memecahkan masalah matematis',
            'Mudah memahami pola dan hubungan',
            'Tertarik pada sains dan teknologi'
        ],
        careers: ['Ilmuwan', 'Programmer', 'Akuntan', 'Insinyur', 'Analis Data', 'Matematikawan'],
        tips: [
            'Bermain puzzle dan permainan logika',
            'Belajar coding atau pemrograman',
            'Eksperimen sains',
            'Main catur atau strategi game'
        ]
    },
    'Spasial': {
        color: '#9b59b6',
        icon: 'üé®',
        description: 'Kecerdasan dalam visualisasi dan orientasi ruang',
        characteristics: [
            'Berpikir dalam gambar dan visualisasi',
            'Pandai menggambar dan mendesain',
            'Mudah membaca peta dan diagram',
            'Memiliki imajinasi visual yang kuat'
        ],
        careers: ['Arsitek', 'Desainer Grafis', 'Fotografer', 'Animator', 'Pilot', 'Seniman'],
        tips: [
            'Menggambar dan melukis',
            'Bermain dengan LEGO atau puzzle 3D',
            'Belajar desain grafis',
            'Fotografi dan videografi'
        ]
    },
    'Musikal': {
        color: '#f1c40f',
        icon: 'üéµ',
        description: 'Kecerdasan dalam memahami dan menciptakan musik',
        characteristics: [
            'Peka terhadap nada dan ritme',
            'Senang bernyanyi atau bermain alat musik',
            'Mudah mengingat melodi',
            'Dapat mengenali pola dalam musik'
        ],
        careers: ['Musisi', 'Penyanyi', 'Komposer', 'DJ', 'Guru Musik', 'Sound Engineer'],
        tips: [
            'Belajar alat musik',
            'Bergabung dengan paduan suara atau band',
            'Membuat musik atau komposisi',
            'Menghadiri konser dan pertunjukan'
        ]
    },
    'Kinestetik': {
        color: '#e67e22',
        icon: '‚öΩ',
        description: 'Kecerdasan dalam menggunakan tubuh dan gerakan',
        characteristics: [
            'Terampil dalam aktivitas fisik',
            'Belajar melalui gerakan dan sentuhan',
            'Koordinasi tubuh yang baik',
            'Senang olahraga dan aktivitas hands-on'
        ],
        careers: ['Atlet', 'Penari', 'Aktor', 'Ahli Bedah', 'Koki', 'Mekanik', 'Pelatih Olahraga'],
        tips: [
            'Berolahraga secara teratur',
            'Ikut kelas tari atau seni bela diri',
            'Kerajinan tangan dan DIY projects',
            'Yoga atau aktivitas fisik lainnya'
        ]
    },
    'Interpersonal': {
        color: '#e74c3c',
        icon: 'üë•',
        description: 'Kecerdasan dalam memahami dan berinteraksi dengan orang lain',
        characteristics: [
            'Mudah bersosialisasi dan berkomunikasi',
            'Peka terhadap perasaan orang lain',
            'Pandai bekerja dalam tim',
            'Memiliki empati yang tinggi'
        ],
        careers: ['Psikolog', 'HR Manager', 'Sales', 'Guru', 'Konselor', 'Politisi', 'Customer Service'],
        tips: [
            'Ikut organisasi atau komunitas',
            'Volunteer untuk kegiatan sosial',
            'Latih kemampuan public speaking',
            'Belajar bahasa tubuh dan komunikasi'
        ]
    },
    'Intrapersonal': {
        color: '#34495e',
        icon: 'üßò',
        description: 'Kecerdasan dalam memahami diri sendiri',
        characteristics: [
            'Memiliki kesadaran diri yang tinggi',
            'Reflektif dan introspektif',
            'Mandiri dalam belajar',
            'Memahami emosi dan motivasi diri'
        ],
        careers: ['Filosof', 'Penulis', 'Peneliti', 'Entrepreneur', 'Life Coach', 'Terapis'],
        tips: [
            'Menulis jurnal refleksi',
            'Meditasi dan mindfulness',
            'Menetapkan tujuan personal',
            'Self-assessment berkala'
        ]
    },
    'Naturalis': {
        color: '#27ae60',
        icon: 'üåø',
        description: 'Kecerdasan dalam memahami alam dan lingkungan',
        characteristics: [
            'Peka terhadap alam dan lingkungan',
            'Senang mengamati flora dan fauna',
            'Peduli terhadap konservasi',
            'Mudah mengenali pola di alam'
        ],
        careers: ['Biolog', 'Botanis', 'Veteriner', 'Petani', 'Konservasionis', 'Geolog'],
        tips: [
            'Berkebun atau merawat tanaman',
            'Hiking dan eksplorasi alam',
            'Mengamati satwa liar',
            'Belajar tentang ekosistem'
        ]
    }
};

async function loadData() {
    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get('token');
    const container = document.getElementById('mainContainer');

    if (!token) {
        container.innerHTML = `<div class="error-msg"><h2>‚ùå Error</h2><p>Token tidak ditemukan di URL</p></div>`;
        return;
    }

    try {
        const response = await fetch(`https://lidan-co-id.pages.dev/api/contacts_filter_dinamis6?table=tes&x_04_eq=${token}`, {
            headers: { 'X-Custom-Auth': 'admin' }
        });
        const res = await response.json();

        if (res.success && res.count > 0) {
            renderResult(res.data[0]);
        } else {
            container.innerHTML = `<div class="error-msg"><h2>‚ùå Data Tidak Ditemukan</h2><p>Token tidak valid atau sudah kadaluarsa</p></div>`;
        }
    } catch (e) {
        container.innerHTML = `<div class="error-msg"><h2>‚ùå Kesalahan Koneksi</h2><p>Tidak dapat terhubung ke server</p></div>`;
    }
}

function renderResult(data) {
    const dataDiri = JSON.parse(data.x_02 || "{}");
    const scores = JSON.parse(data.x_03 || "{}");
    
    // Urutkan berdasarkan skor
    const sortedScores = Object.entries(scores).sort((a, b) => b[1] - a[1]);
    const dominantIntelligences = sortedScores.filter(([_, score]) => score >= 8);
    
    const chartLabels = sortedScores.map(([name]) => name);
    const chartData = sortedScores.map(([_, score]) => score);
    const chartColors = sortedScores.map(([name]) => INTELLIGENCES[name]?.color || '#95a5a6');

    let scoreCardsHTML = '';
    sortedScores.forEach(([name, score]) => {
        const intel = INTELLIGENCES[name] || {};
        const isDominant = score >= 8;
        scoreCardsHTML += `
            <div class="score-card ${isDominant ? 'dominant' : ''}" style="border-color: ${intel.color};">
                <div class="score-header">
                    <div>
                        <div style="font-size: 1.5em; margin-bottom: 5px;">${intel.icon}</div>
                        <div class="score-name" style="color: ${intel.color};">${name}</div>
                    </div>
                    <div class="score-value" style="color: ${intel.color};">${score}/10</div>
                </div>
                <div class="score-bar">
                    <div class="score-fill" style="width: ${score * 10}%; background: ${intel.color};"></div>
                </div>
            </div>
        `;
    });

    const html = `
        <div class="header">
            <h1>üß† Hasil Tes Kecerdasan Majemuk</h1>
            <p>Multiple Intelligences - Howard Gardner</p>
        </div>
        <div class="content">
            <div class="profile-section">
                <h3 style="color: #2c3e50; margin-bottom: 15px;">üìã Informasi Peserta</h3>
                <div class="profile-grid">
                    <div class="profile-item">
                        <span class="profile-label">Nama Lengkap</span>
                        <span class="profile-value">${dataDiri.nama || '-'}</span>
                    </div>
                    <div class="profile-item">
                        <span class="profile-label">Usia</span>
                        <span class="profile-value">${dataDiri.usia || '-'} Tahun</span>
                    </div>
                    <div class="profile-item">
                        <span class="profile-label">Pendidikan</span>
                        <span class="profile-value">${dataDiri.pendidikan || '-'}</span>
                    </div>
                    <div class="profile-item">
                        <span class="profile-label">Tanggal Tes</span>
                        <span class="profile-value">${data.x_05 || '-'}</span>
                    </div>
                </div>
            </div>

            ${dominantIntelligences.length > 0 ? `
            <div class="dominant-section">
                <h2>üåü Kecerdasan Dominan Anda</h2>
                <p style="opacity: 0.9; margin-bottom: 10px;">Kecerdasan dengan skor ‚â• 8 dari 10</p>
                <div class="dominant-list">
                    ${dominantIntelligences.map(([name]) => `
                        <div class="dominant-badge">${INTELLIGENCES[name]?.icon} ${name}</div>
                    `).join('')}
                </div>
            </div>
            ` : `
            <div class="info-section" style="background: #fff3cd; border-color: #ffc107;">
                <h3 style="color: #856404;">üí° Informasi</h3>
                <p style="color: #856404;">Tidak ada kecerdasan yang mencapai skor dominan (‚â•8). Ini menunjukkan Anda memiliki kecerdasan yang seimbang di berbagai area.</p>
            </div>
            `}

            <div class="score-grid">
                ${scoreCardsHTML}
            </div>

            <div class="chart-container">
                <canvas id="myChart"></canvas>
            </div>

            ${dominantIntelligences.slice(0, 3).map(([name, score]) => {
                const intel = INTELLIGENCES[name] || {};
                return `
                    <div class="intelligence-detail" style="border-color: ${intel.color};">
                        <h4 style="color: ${intel.color};">${intel.icon} ${name} (${score}/10)</h4>
                        <p style="margin-bottom: 15px; color: #555;"><em>${intel.description}</em></p>
                        
                        <p style="font-weight: bold; margin: 10px 0; color: #2c3e50;">üéØ Karakteristik:</p>
                        <ul>
                            ${intel.characteristics?.map(char => `<li>${char}</li>`).join('') || ''}
                        </ul>
                        
                        <p style="font-weight: bold; margin: 15px 0 10px 0; color: #2c3e50;">üíº Karir yang Cocok:</p>
                        <p style="color: #555;">${intel.careers?.join(', ') || '-'}</p>
                        
                        <p style="font-weight: bold; margin: 15px 0 10px 0; color: #2c3e50;">üí° Tips Pengembangan:</p>
                        <ul>
                            ${intel.tips?.map(tip => `<li>${tip}</li>`).join('') || ''}
                        </ul>
                    </div>
                `;
            }).join('')}

            <div class="info-section">
                <h3>üìö Tentang Kecerdasan Majemuk</h3>
                <p style="line-height: 1.8; color: #555;">
                    Teori Kecerdasan Majemuk dikembangkan oleh Howard Gardner yang menyatakan bahwa setiap orang memiliki kombinasi unik dari 8 jenis kecerdasan. 
                    Tidak ada yang "lebih pintar" dari yang lain - setiap kecerdasan memiliki nilai dan kegunaan tersendiri. 
                    Memahami kecerdasan dominan Anda dapat membantu dalam memilih metode belajar, karir, dan aktivitas yang sesuai dengan potensi Anda.
                </p>
            </div>

            <div class="button-group">
                <button class="btn-download" onclick="downloadAsImage()">üì• Download JPG</button>
                <button class="btn-print" onclick="window.print()">üñ®Ô∏è Cetak PDF</button>
            </div>
        </div>
    `;

    document.getElementById('mainContainer').innerHTML = html;
    createChart(chartLabels, chartData, chartColors);
}

function createChart(labels, data, colors) {
    const ctx = document.getElementById('myChart').getContext('2d');
    new Chart(ctx, {
        type: 'radar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Skor Kecerdasan',
                data: data,
                backgroundColor: 'rgba(102, 126, 234, 0.2)',
                borderColor: '#667eea',
                borderWidth: 3,
                pointBackgroundColor: colors,
                pointBorderColor: '#fff',
                pointBorderWidth: 2,
                pointRadius: 6,
                pointHoverRadius: 8
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                r: {
                    beginAtZero: true,
                    max: 10,
                    ticks: {
                        stepSize: 2,
                        font: { size: 12 }
                    },
                    pointLabels: {
                        font: { size: 13, weight: 'bold' }
                    }
                }
            },
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return `Skor: ${context.parsed.r}/10`;
                        }
                    }
                }
            }
        }
    });
}

async function downloadAsImage() {
    const button = event.target;
    button.disabled = true;
    button.textContent = '‚è≥ Memproses...';
    
    try {
        const container = document.getElementById('mainContainer');
        const canvas = await html2canvas(container, {
            scale: 2,
            backgroundColor: '#ffffff',
            logging: false
        });
        
        const link = document.createElement('a');
        link.download = `Hasil-Kecerdasan-Majemuk-${Date.now()}.jpg`;
        link.href = canvas.toDataURL('image/jpeg', 0.95);
        link.click();
        
        button.disabled = false;
        button.textContent = '‚úÖ Download Berhasil!';
        setTimeout(() => {
            button.textContent = 'üì• Download JPG';
        }, 2000);
    } catch (error) {
        button.disabled = false;
        button.textContent = '‚ùå Gagal';
        setTimeout(() => {
            button.textContent = 'üì• Download JPG';
        }, 2000);
    }
}

loadData();
</script>
</body>
</html>