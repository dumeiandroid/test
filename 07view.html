<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hasil Tes Thinking vs Feeling</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px; 
        }
        .container { 
            max-width: 850px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }
        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }
        .content {
            padding: 40px;
        }
        .profile-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 5px solid #667eea;
        }
        .profile-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .profile-item {
            display: flex;
            flex-direction: column;
        }
        .profile-label {
            font-size: 0.85em;
            color: #667eea;
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        .profile-value {
            font-size: 1.1em;
            color: #2c3e50;
        }
        .result-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 40px;
            border-radius: 15px;
            margin: 30px 0;
            border-left: 8px solid;
            text-align: center;
        }
        .result-card h2 {
            font-size: 3em;
            margin-bottom: 15px;
        }
        .result-tagline {
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .spectrum {
            display: flex;
            align-items: center;
            gap: 20px;
            margin: 30px 0;
            background: white;
            padding: 30px;
            border-radius: 15px;
        }
        .spectrum-side {
            flex: 1;
            text-align: center;
        }
        .spectrum-icon {
            font-size: 4em;
            margin-bottom: 10px;
        }
        .spectrum-name {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .spectrum-score {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
        }
        .spectrum-bar {
            flex: 2;
            position: relative;
        }
        .bar-container {
            height: 40px;
            background: linear-gradient(to right, #2980b9, #e91e63);
            border-radius: 20px;
            position: relative;
            overflow: hidden;
        }
        .bar-marker {
            position: absolute;
            top: -30px;
            transform: translateX(-50%);
            font-size: 2em;
        }
        .chart-container {
            position: relative;
            height: 300px;
            margin: 30px 0;
        }
        .info-section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            border: 2px solid #e9ecef;
        }
        .info-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .info-section ul {
            list-style: none;
            padding-left: 0;
        }
        .info-section li {
            padding: 10px 0;
            padding-left: 30px;
            position: relative;
            line-height: 1.6;
            color: #555;
        }
        .info-section li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #667eea;
            font-weight: bold;
            font-size: 1.2em;
        }
        .comparison-table {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .table-column {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }
        .table-column h4 {
            text-align: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 3px solid;
            font-size: 1.2em;
        }
        .table-column ul {
            list-style: none;
            padding: 0;
        }
        .table-column li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
            color: #444;
        }
        .table-column li:before {
            content: "‚Ä¢";
            position: absolute;
            left: 5px;
            font-size: 1.5em;
        }
        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 30px;
        }
        button {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-download {
            background: #667eea;
            color: white;
        }
        .btn-download:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        .btn-print {
            background: #2c3e50;
            color: white;
        }
        .btn-print:hover {
            background: #1a252f;
            transform: translateY(-2px);
        }
        .error-msg {
            text-align: center;
            padding: 60px 40px;
            color: #e74c3c;
        }
        .loading {
            text-align: center;
            padding: 60px 40px;
            color: #7f8c8d;
        }
        @media print {
            body { background: white; padding: 0; }
            .button-group { display: none; }
            .container { box-shadow: none; }
        }
        @media (max-width: 600px) {
            .header h1 { font-size: 1.5em; }
            .result-card h2 { font-size: 2em; }
            .button-group { grid-template-columns: 1fr; }
            .comparison-table { grid-template-columns: 1fr; }
            .spectrum { flex-direction: column; }
        }
    </style>
</head>
<body>

<div class="container" id="mainContainer">
    <div class="loading">
        <div style="font-size: 3em; margin-bottom: 20px;">‚è≥</div>
        <h3>Memuat Hasil Tes...</h3>
    </div>
</div>

<script>
const DECISION_TYPES = {
    THINKING: {
        name: 'THINKING (PEMIKIR)',
        color: '#2980b9',
        icon: 'üß†',
        tagline: 'Keputusan Berdasarkan Logika',
        description: 'Anda membuat keputusan berdasarkan analisis objektif, logika, dan kebenaran. Anda mengutamakan konsistensi dan keadilan dalam pengambilan keputusan.',
        characteristics: [
            'Mengutamakan logika dan rasionalitas',
            'Objektif dalam menilai situasi',
            'Fokus pada kebenaran dan fakta',
            'Menganalisis pro dan kontra',
            'Tegas dan direct dalam komunikasi',
            'Menjaga jarak emosional saat memutuskan',
            'Menghargai kompetensi dan keahlian',
            'Konsisten dengan prinsip'
        ],
        strengths: [
            'Analisis objektif',
            'Keputusan yang fair',
            'Critical thinking',
            'Ketegasan',
            'Konsistensi logika'
        ],
        weaknesses: [
            'Kurang sensitif terhadap perasaan',
            'Terkesan dingin atau keras',
            'Terlalu kritis',
            'Sulit berempati',
            'Mengabaikan aspek emosional'
        ],
        careers: ['Engineer', 'Programmer', 'Analyst', 'Lawyer', 'Scientist', 'Financial Planner', 'Manager', 'Auditor'],
        tips: [
            'Pertimbangkan dampak emosional keputusan Anda',
            'Latih empati dan kepekaan terhadap perasaan orang lain',
            'Berikan apresiasi, bukan hanya kritik',
            'Komunikasi dengan lebih lembut saat diperlukan',
            'Ingat bahwa perasaan juga valid dalam keputusan'
        ]
    },
    FEELING: {
        name: 'FEELING (PERASA)',
        color: '#e91e63',
        icon: '‚ù§Ô∏è',
        tagline: 'Keputusan Berdasarkan Nilai & Empati',
        description: 'Anda membuat keputusan berdasarkan nilai-nilai personal, empati, dan dampak terhadap orang lain. Anda mengutamakan harmoni dan kesejahteraan dalam pengambilan keputusan.',
        characteristics: [
            'Mengutamakan nilai dan empati',
            'Mempertimbangkan dampak terhadap orang lain',
            'Fokus pada harmoni dan kesejahteraan',
            'Subjektif berdasarkan nilai personal',
            'Diplomatik dalam komunikasi',
            'Terhubung emosional dengan situasi',
            'Menghargai hubungan dan perasaan',
            'Fleksibel sesuai konteks personal'
        ],
        strengths: [
            'Empati tinggi',
            'Membangun hubungan',
            'Kepekaan emosional',
            'Diplomasi',
            'Menciptakan harmoni'
        ],
        weaknesses: [
            'Terlalu subjektif',
            'Sulit bersikap tegas',
            'Mudah terpengaruh emosi',
            'Menghindari konflik penting',
            'Keputusan kurang objektif'
        ],
        careers: ['Counselor', 'HR Professional', 'Teacher', 'Social Worker', 'Nurse', 'Customer Service', 'Mediator', 'Psychologist'],
        tips: [
            'Jangan takut membuat keputusan sulit',
            'Latih objektivitas dalam analisis',
            'Tidak semua konflik perlu dihindari',
            'Seimbangkan empati dengan logika',
            'Belajar mengatakan "tidak" saat perlu'
        ]
    }
};

async function loadData() {
    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get('token');
    const container = document.getElementById('mainContainer');

    if (!token) {
        container.innerHTML = `<div class="error-msg"><h2>‚ùå Error</h2><p>Token tidak ditemukan di URL</p></div>`;
        return;
    }

    try {
        const response = await fetch(`https://lidan-co-id.pages.dev/api/contacts_filter_dinamis6?table=tes&x_04_eq=${token}`, {
            headers: { 'X-Custom-Auth': 'admin' }
        });
        const res = await response.json();

        if (res.success && res.count > 0) {
            renderResult(res.data[0]);
        } else {
            container.innerHTML = `<div class="error-msg"><h2>‚ùå Data Tidak Ditemukan</h2><p>Token tidak valid atau sudah kadaluarsa</p></div>`;
        }
    } catch (e) {
        container.innerHTML = `<div class="error-msg"><h2>‚ùå Kesalahan Koneksi</h2><p>Tidak dapat terhubung ke server</p></div>`;
    }
}

function renderResult(data) {
    const dataDiri = JSON.parse(data.x_02 || "{}");
    const scores = JSON.parse(data.x_03 || "{}");
    
    const total = 20;
    const skorThinking = scores.A || 0;
    const skorFeeling = scores.B || 0;
    
    const persenThinking = Math.round((skorThinking / total) * 100);
    const persenFeeling = Math.round((skorFeeling / total) * 100);
    
    const isThinking = skorThinking >= skorFeeling;
    const personality = isThinking ? DECISION_TYPES.THINKING : DECISION_TYPES.FEELING;
    const secondary = isThinking ? DECISION_TYPES.FEELING : DECISION_TYPES.THINKING;
    
    const markerPosition = (skorThinking / total) * 100;

    const html = `
        <div class="header">
            <h1>‚öñÔ∏è Hasil Tes Pengambilan Keputusan</h1>
            <p>Saya Termasuk Tipe Pemikir atau Perasa?</p>
        </div>
        <div class="content">
            <div class="profile-section">
                <h3 style="color: #2c3e50; margin-bottom: 15px;">üìã Informasi Peserta</h3>
                <div class="profile-grid">
                    <div class="profile-item">
                        <span class="profile-label">Nama Lengkap</span>
                        <span class="profile-value">${dataDiri.nama || '-'}</span>
                    </div>
                    <div class="profile-item">
                        <span class="profile-label">Usia</span>
                        <span class="profile-value">${dataDiri.usia || '-'} Tahun</span>
                    </div>
                    <div class="profile-item">
                        <span class="profile-label">Pendidikan</span>
                        <span class="profile-value">${dataDiri.pendidikan || '-'}</span>
                    </div>
                    <div class="profile-item">
                        <span class="profile-label">Tanggal Tes</span>
                        <span class="profile-value">${data.x_05 || '-'}</span>
                    </div>
                </div>
            </div>

            <div class="result-card" style="border-color: ${personality.color};">
                <h2 style="color: ${personality.color};">${personality.icon} ${personality.name}</h2>
                <div class="result-tagline" style="color: ${personality.color};">${personality.tagline}</div>
                <p style="font-size: 1.1em; color: #555;">${personality.description}</p>
            </div>

            <div class="spectrum">
                <div class="spectrum-side">
                    <div class="spectrum-icon">üß†</div>
                    <div class="spectrum-name" style="color: #2980b9;">Thinking</div>
                    <div class="spectrum-score" style="color: #2980b9;">${persenThinking}%</div>
                    <div style="color: #666;">${skorThinking}/${total}</div>
                </div>
                
                <div class="spectrum-bar">
                    <div class="bar-marker" style="left: ${markerPosition}%;">üë§</div>
                    <div class="bar-container">
                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-weight: bold; font-size: 0.9em;">
                            Spektrum Keputusan
                        </div>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-top: 10px; color: #666; font-size: 0.9em;">
                        <span>Logika</span>
                        <span>Seimbang</span>
                        <span>Empati</span>
                    </div>
                </div>
                
                <div class="spectrum-side">
                    <div class="spectrum-icon">‚ù§Ô∏è</div>
                    <div class="spectrum-name" style="color: #e91e63;">Feeling</div>
                    <div class="spectrum-score" style="color: #e91e63;">${persenFeeling}%</div>
                    <div style="color: #666;">${skorFeeling}/${total}</div>
                </div>
            </div>

            <div class="chart-container">
                <canvas id="myChart"></canvas>
            </div>

            <div class="info-section">
                <h3>üéØ Karakteristik Anda</h3>
                <ul>
                    ${personality.characteristics.map(char => `<li>${char}</li>`).join('')}
                </ul>
            </div>

            <div class="info-section">
                <h3>üí™ Kekuatan Anda</h3>
                <ul>
                    ${personality.strengths.map(strength => `<li>${strength}</li>`).join('')}
                </ul>
            </div>

            <div class="info-section">
                <h3>‚ö†Ô∏è Area Pengembangan</h3>
                <ul>
                    ${personality.weaknesses.map(weakness => `<li>${weakness}</li>`).join('')}
                </ul>
            </div>

            <div class="info-section">
                <h3>üíº Karir yang Cocok</h3>
                <p style="color: #555; line-height: 1.8; font-size: 1.1em;">
                    ${personality.careers.join(' ‚Ä¢ ')}
                </p>
            </div>

            <div class="info-section">
                <h3>üí° Saran Pengembangan Diri</h3>
                <ul>
                    ${personality.tips.map(tip => `<li>${tip}</li>`).join('')}
                </ul>
            </div>

            <div class="info-section">
                <h3>‚öñÔ∏è Perbandingan Thinking vs Feeling</h3>
                <div class="comparison-table">
                    <div class="table-column">
                        <h4 style="color: #2980b9; border-color: #2980b9;">üß† Thinking</h4>
                        <ul>
                            <li style="color: #2980b9;">Logika & Objektif</li>
                            <li style="color: #2980b9;">Kebenaran & Fakta</li>
                            <li style="color: #2980b9;">Analisis Pro-Kontra</li>
                            <li style="color: #2980b9;">Tegas & Direct</li>
                            <li style="color: #2980b9;">Konsistensi Prinsip</li>
                            <li style="color: #2980b9;">Jarak Emosional</li>
                        </ul>
                    </div>
                    <div class="table-column">
                        <h4 style="color: #e91e63; border-color: #e91e63;">‚ù§Ô∏è Feeling</h4>
                        <ul>
                            <li style="color: #e91e63;">Empati & Subjektif</li>
                            <li style="color: #e91e63;">Nilai & Harmoni</li>
                            <li style="color: #e91e63;">Dampak Orang Lain</li>
                            <li style="color: #e91e63;">Diplomatik & Lembut</li>
                            <li style="color: #e91e63;">Fleksibel Kontekstual</li>
                            <li style="color: #e91e63;">Koneksi Emosional</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="info-section" style="background: #fff3cd; border-color: #ffc107;">
                <h3 style="color: #856404;">üìö Dalam Konteks MBTI</h3>
                <p style="color: #856404; line-height: 1.8;">
                    Dimensi Thinking-Feeling adalah salah satu dari 4 dimensi dalam Myers-Briggs Type Indicator (MBTI). 
                    Dimensi ini menggambarkan bagaimana Anda membuat keputusan. 
                    <strong>Penting:</strong> Thinking bukan berarti tidak punya perasaan, dan Feeling bukan berarti tidak bisa berpikir logis. 
                    Ini hanya tentang preferensi Anda saat mengambil keputusan.
                </p>
            </div>

            <div class="button-group">
                <button class="btn-download" onclick="downloadAsImage()">üì• Download JPG</button>
                <button class="btn-print" onclick="window.print()">üñ®Ô∏è Cetak PDF</button>
            </div>
        </div>
    `;

    document.getElementById('mainContainer').innerHTML = html;
    createChart(skorThinking, skorFeeling, persenThinking, persenFeeling);
}

function createChart(skorThinking, skorFeeling, persenThinking, persenFeeling) {
    const ctx = document.getElementById('myChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Thinking', 'Feeling'],
            datasets: [{
                label: 'Skor',
                data: [skorThinking, skorFeeling],
                backgroundColor: [
                    'rgba(41, 128, 185, 0.7)',
                    'rgba(233, 30, 99, 0.7)'
                ],
                borderColor: [
                    '#2980b9',
                    '#e91e63'
                ],
                borderWidth: 3
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const percentage = context.dataIndex === 0 ? persenThinking : persenFeeling;
                            return `Skor: ${context.parsed.y}/20 (${percentage}%)`;
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    max: 10,
                    ticks: {
                        stepSize: 2
                    }
                }
            }
        }
    });
}

async function downloadAsImage() {
    const button = event.target;
    button.disabled = true;
    button.textContent = '‚è≥ Memproses...';
    
    try {
        const container = document.getElementById('mainContainer');
        const canvas = await html2canvas(container, {
            scale: 2,
            backgroundColor: '#ffffff',
            logging: false
        });
        
        const link = document.createElement('a');
        link.download = `Hasil-Thinking-Feeling-${Date.now()}.jpg`;
        link.href = canvas.toDataURL('image/jpeg', 0.95);
        link.click();
        
        button.disabled = false;
        button.textContent = '‚úÖ Download Berhasil!';
        setTimeout(() => {
            button.textContent = 'üì• Download JPG';
        }, 2000);
    } catch (error) {
        button.disabled = false;
        button.textContent = '‚ùå Gagal';
        setTimeout(() => {
            button.textContent = 'üì• Download JPG';
        }, 2000);
    }
}

loadData();
</script>
</body>
</html>