<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hasil Tes Dominasi Otak</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px; 
        }
        .container { 
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        .header h1 { font-size: 2em; margin-bottom: 10px; }
        .header p { opacity: 0.9; font-size: 1.1em; }
        .content { padding: 40px; }
        .profile-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 5px solid #667eea;
        }
        .profile-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .profile-label { font-size: 0.85em; color: #667eea; font-weight: bold; text-transform: uppercase; margin-bottom: 5px; }
        .profile-value { font-size: 1.1em; color: #2c3e50; }
        .chart-container { position: relative; height: 300px; margin: 30px 0; }
        .result-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
            border-left: 8px solid;
            transition: all 0.5s ease;
        }
        .result-card h2 { font-size: 2.5em; margin-bottom: 15px; display: flex; align-items: center; gap: 15px; }
        .brain-comparison { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 25px 0; }
        .brain-side { background: white; padding: 20px; border-radius: 12px; text-align: center; border: 3px solid; opacity: 0.7; transition: all 0.3s; }
        .brain-side.active { box-shadow: 0 5px 25px rgba(0,0,0,0.15); transform: scale(1.05); opacity: 1; }
        .brain-percentage { font-size: 3em; font-weight: bold; margin: 15px 0; }
        .info-section { background: white; padding: 25px; border-radius: 15px; margin: 20px 0; border: 2px solid #e9ecef; }
        .info-section h3 { color: #2c3e50; margin-bottom: 15px; font-size: 1.3em; display: flex; align-items: center; gap: 10px; }
        .info-section ul { list-style: none; padding-left: 0; }
        .info-section li { padding: 10px 0; padding-left: 30px; position: relative; line-height: 1.6; color: #555; }
        .info-section li:before { content: "‚úì"; position: absolute; left: 0; color: #667eea; font-weight: bold; font-size: 1.2em; }
        .comparison-table { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }
        .table-column { background: #f8f9fa; padding: 20px; border-radius: 10px; }
        .table-column h4 { text-align: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 3px solid; }
        .table-column li { padding: 8px 0; padding-left: 25px; position: relative; color: #444; list-style: none; }
        .table-column li:before { content: "‚Ä¢"; position: absolute; left: 5px; font-size: 1.5em; }
        .button-group { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 30px; }
        button { padding: 15px 30px; border: none; border-radius: 10px; font-size: 1em; font-weight: bold; cursor: pointer; transition: all 0.3s; }
        .btn-download { background: #667eea; color: white; }
        .btn-print { background: #2c3e50; color: white; }
        .error-msg { text-align: center; padding: 60px 40px; color: #e74c3c; }
        .loading { text-align: center; padding: 60px 40px; color: #7f8c8d; }
        @media print { .button-group { display: none; } .container { box-shadow: none; } body { background: white; } }
        @media (max-width: 600px) { .brain-comparison, .comparison-table, .button-group { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container" id="mainContainer">
    <div class="loading">
        <div style="font-size: 3em; margin-bottom: 20px;">‚è≥</div>
        <h3>Memuat Hasil Analisis Dominasi Otak...</h3>
    </div>
</div>

<script>
const BRAIN_TYPES = {
    LEFT: {
        name: 'OTAK KIRI',
        color: '#2980b9',
        icon: 'üß†',
        description: 'Anda memiliki kecenderungan berpikir secara Logis, Analitis, dan Terstruktur.',
        characteristics: ['Berpikir logis dan sistematis', 'Suka hal terstruktur', 'Pandai matematika/sains', 'Kemampuan verbal baik', 'Realistis & praktis', 'Suka detail dan fakta'],
        strengths: ['Pemikiran kritis', 'Analisis data', 'Perencanaan strategis', 'Pemecahan masalah matematis', 'Kemampuan bahasa'],
        careers: ['Akuntan', 'Programmer', 'Analis Data', 'Insinyur', 'Ilmuwan', 'Pengacara', 'Dokter'],
        tips: ['Buat jadwal terstruktur', 'Gunakan metode analisis langkah-demi-langkah', 'Fokus pada fakta konkret', 'Latih kreativitas untuk keseimbangan']
    },
    RIGHT: {
        name: 'OTAK KANAN',
        color: '#e74c3c',
        icon: 'üé®',
        description: 'Anda memiliki kecenderungan berpikir secara Kreatif, Intuitif, dan Imajinatif.',
        characteristics: ['Berpikir kreatif dan imajinatif', 'Intuisi yang kuat', 'Pandai dalam seni/musik', 'Proses informasi secara visual', 'Spontan & fleksibel', 'Melihat gambaran besar'],
        strengths: ['Kreativitas tinggi', 'Pemikiran visual-spasial', 'Intuisi tajam', 'Inovasi', 'Ekspresi emosional'],
        careers: ['Desainer Grafis', 'Seniman', 'Musisi', 'Arsitek', 'Penulis Kreatif', 'Fotografer', 'Marketing Kreatif'],
        tips: ['Gunakan mind mapping', 'Ekspresikan ide melalui visual', 'Manfaatkan intuisi dalam keputusan', 'Ciptakan lingkungan kerja inspiratif']
    },
    BALANCED: {
        name: 'OTAK SEIMBANG',
        color: '#8e44ad',
        icon: '‚òØÔ∏è',
        description: 'Anda memiliki profil "Whole Brain Thinking" yang luar biasa seimbang!',
        characteristics: ['Mampu beralih antara logika dan kreativitas', 'Sangat adaptif dalam berbagai situasi', 'Mempertimbangkan fakta dan perasaan', 'Multitasking teknis dan artistik', 'Melihat masalah dari berbagai sudut pandang'],
        strengths: ['Fleksibilitas kognitif', 'Manajemen proyek kompleks', 'Komunikasi empatik namun logis', 'Kemampuan belajar cepat', 'Harmonisasi visi besar dan detail'],
        careers: ['Project Manager', 'Sutradara', 'Wirausahawan', 'Konsultan Strategis', 'Editor Film', 'Psikolog'],
        tips: ['Jadilah jembatan antara tim kreatif dan teknis', 'Waspadai keraguan karena terlalu banyak pertimbangan', 'Latih pengambilan keputusan cepat', 'Gunakan kedua sisi otak secara sadar']
    }
};

async function loadData() {
    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get('token');
    const container = document.getElementById('mainContainer');

    if (!token) {
        container.innerHTML = `<div class="error-msg"><h2>‚ùå Error</h2><p>Token tidak ditemukan di URL</p></div>`;
        return;
    }

    try {
        const response = await fetch(`https://lidan-co-id.pages.dev/api/contacts_filter_dinamis6?table=tes&x_04_eq=${token}`, {
            headers: { 'X-Custom-Auth': 'admin' }
        });
        const res = await response.json();
        if (res.success && res.count > 0) renderResult(res.data[0]);
        else container.innerHTML = `<div class="error-msg"><h2>‚ùå Data Tidak Ditemukan</h2><p>Token tidak valid</p></div>`;
    } catch (e) {
        container.innerHTML = `<div class="error-msg"><h2>‚ùå Kesalahan Koneksi</h2><p>Gagal terhubung ke server</p></div>`;
    }
}

function renderResult(data) {
    const dataDiri = JSON.parse(data.x_02 || "{}");
    const jawaban = JSON.parse(data.x_03 || "{}");
    
    let skorKiri = 0, skorKanan = 0;
    Object.keys(jawaban).forEach(key => {
        if (key.startsWith('A')) skorKiri++;
        if (key.startsWith('B')) skorKanan++;
    });
    
    const total = skorKiri + skorKanan || 1;
    const persenKiri = Math.round((skorKiri / total) * 100);
    const persenKanan = Math.round((skorKanan / total) * 100);
    
    let dominant;
    if (skorKiri === skorKanan) dominant = BRAIN_TYPES.BALANCED;
    else dominant = skorKiri > skorKanan ? BRAIN_TYPES.LEFT : BRAIN_TYPES.RIGHT;

    document.getElementById('mainContainer').innerHTML = `
        <div class="header">
            <h1>üß† Hasil Tes Dominasi Otak</h1>
            <p>Analisis Kecenderungan Berpikir Peserta</p>
        </div>
        <div class="content">
            <div class="profile-section">
                <h3 style="color: #2c3e50; margin-bottom: 15px;">üìã Informasi Peserta</h3>
                <div class="profile-grid">
                    <div class="profile-item"><span class="profile-label">Nama</span><span class="profile-value">${dataDiri.nama || '-'}</span></div>
                    <div class="profile-item"><span class="profile-label">Usia</span><span class="profile-value">${dataDiri.usia || '-'} Thn</span></div>
                    <div class="profile-item"><span class="profile-label">Pendidikan</span><span class="profile-value">${dataDiri.pendidikan || '-'}</span></div>
                    <div class="profile-item"><span class="profile-label">Tanggal</span><span class="profile-value">${data.x_05 || '-'}</span></div>
                </div>
            </div>

            <div class="result-card" style="border-color: ${dominant.color};">
                <h2 style="color: ${dominant.color};">${dominant.icon} ${dominant.name}</h2>
                <p style="font-size: 1.1em; color: #555; margin-bottom: 20px;">${dominant.description}</p>
                <div class="brain-comparison">
                    <div class="brain-side ${skorKiri >= skorKanan ? 'active' : ''}" style="border-color: #2980b9;">
                        <h3 style="color: #2980b9;">Otak Kiri</h3>
                        <div class="brain-percentage" style="color: #2980b9;">${persenKiri}%</div>
                    </div>
                    <div class="brain-side ${skorKanan >= skorKiri ? 'active' : ''}" style="border-color: #e74c3c;">
                        <h3 style="color: #e74c3c;">Otak Kanan</h3>
                        <div class="brain-percentage" style="color: #e74c3c;">${persenKanan}%</div>
                    </div>
                </div>
            </div>

            <div class="chart-container"><canvas id="myChart"></canvas></div>

            <div class="info-section"><h3>üéØ Karakteristik</h3><ul>${dominant.characteristics.map(c => `<li>${c}</li>`).join('')}</ul></div>
            <div class="info-section"><h3>üí™ Kekuatan</h3><ul>${dominant.strengths.map(s => `<li>${s}</li>`).join('')}</ul></div>
            <div class="info-section"><h3>üíº Karier Cocok</h3><ul>${dominant.careers.map(c => `<li>${c}</li>`).join('')}</ul></div>
            <div class="info-section"><h3>üí° Tips Untuk Anda</h3><ul>${dominant.tips.map(t => `<li>${t}</li>`).join('')}</ul></div>

            <div class="button-group">
                <button class="btn-download" onclick="downloadAsImage()">üì• Download JPG</button>
                <button class="btn-print" onclick="window.print()">üñ®Ô∏è Cetak PDF</button>
            </div>
        </div>`;
    createChart(skorKiri, skorKanan);
}

function createChart(sk, sn) {
    const ctx = document.getElementById('myChart').getContext('2d');
    new Chart(ctx, {
        type: 'pie',
        data: {
            labels: ['Otak Kiri', 'Otak Kanan'],
            datasets: [{ data: [sk, sn], backgroundColor: ['#2980b9', '#e74c3c'], borderWidth: 5, borderColor: '#fff' }]
        },
        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
    });
}

async function downloadAsImage() {
    const btn = event.target;
    btn.textContent = '‚è≥ Memproses...';
    try {
        const canvas = await html2canvas(document.getElementById('mainContainer'), { scale: 2 });
        const link = document.createElement('a');
        link.download = `Hasil-Tes-Otak.jpg`;
        link.href = canvas.toDataURL('image/jpeg');
        link.click();
        btn.textContent = 'üì• Download JPG';
    } catch (e) { btn.textContent = '‚ùå Gagal'; }
}

loadData();
</script>
</body>
</html>