<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hasil Tes Motivasi Kepemimpinan</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #2c3e50; --accent: #3498db; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 20px; display: flex; justify-content: center; }
        .container { background: white; width: 100%; max-width: 600px; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .header { text-align: center; border-bottom: 2px solid #eee; padding-bottom: 20px; margin-bottom: 20px; }
        .user-info { font-size: 0.9em; color: #666; margin-bottom: 20px; line-height: 1.6; }
        .score-box { text-align: center; padding: 20px; background: #f8f9fa; border-radius: 15px; margin-bottom: 25px; }
        .score-value { font-size: 48px; font-weight: bold; color: var(--accent); }
        .score-label { font-size: 18px; color: var(--primary); margin-top: 5px; font-weight: 600; }
        .interpretation { line-height: 1.8; color: #444; text-align: justify; }
        .btn-action { display: block; width: 100%; padding: 12px; margin-top: 25px; background: var(--primary); color: white; text-align: center; text-decoration: none; border-radius: 10px; font-weight: bold; }
        #loading { text-align: center; padding: 50px; }
        .chart-container { margin: 20px 0; }
    </style>
</head>
<body>

<div class="container" id="main-content">
    <div id="loading">Memuat hasil analisis...</div>
</div>

<script>
    const API_URL = "https://lidan-co-id.pages.dev/api/contacts_filter_dinamis6?table=tes";
    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get('token');

    if (!token) {
        document.getElementById('main-content').innerHTML = "<h2>Token tidak ditemukan</h2>";
    } else {
        fetchData();
    }

    async function fetchData() {
        try {
            const response = await fetch(`${API_URL}&x_04=${token}`, {
                headers: { 'X-Custom-Auth': 'admin' }
            });
            const result = await response.json();
            
            if (result.success && result.data.length > 0) {
                renderResult(result.data[0]);
            } else {
                document.getElementById('main-content').innerHTML = "<h2>Data tidak ditemukan.</h2>";
            }
        } catch (error) {
            console.error(error);
            document.getElementById('main-content').innerHTML = "<h2>Gagal memuat data.</h2>";
        }
    }

    function renderResult(data) {
        const dataDiri = JSON.parse(data.x_02);
        const jawaban = JSON.parse(data.x_03);
        
        // Hitung total skor (14 soal, skor 1-5)
        let totalSkor = 0;
        for (let key in jawaban) {
            totalSkor += jawaban[key];
        }

        // Tentukan kategori
        let kategori = "";
        let deskripsi = "";
        
        if (totalSkor >= 56) {
            kategori = "Sangat Kuat";
            deskripsi = "Anda memiliki dorongan kepemimpinan yang luar biasa. Anda merasa nyaman memikul tanggung jawab besar, berani mengambil risiko, dan memiliki visi yang jelas untuk menggerakkan orang lain. Anda adalah tipe pemimpin alami yang proaktif.";
        } else if (totalSkor >= 42) {
            kategori = "Cukup Kuat";
            deskripsi = "Anda memiliki motivasi yang baik untuk menjadi pemimpin. Anda bersedia mengarahkan tim dan mengambil tanggung jawab, meskipun terkadang masih ada keraguan dalam situasi yang sangat menekan. Potensi Anda sangat besar untuk dikembangkan.";
        } else if (totalSkor >= 28) {
            kategori = "Moderat";
            deskripsi = "Anda cenderung memilih menjadi pendukung atau pemimpin hanya jika situasi benar-benar mendesak. Motivasi kepemimpinan Anda bersifat situasional. Anda bekerja sangat baik dalam struktur yang sudah ada namun kurang proaktif dalam mengambil alih kendali.";
        } else {
            kategori = "Rendah";
            deskripsi = "Saat ini, motivasi Anda untuk memimpin masih rendah. Anda mungkin lebih nyaman bekerja secara mandiri atau mengikuti arahan orang lain. Hal ini tidak buruk, namun jika ingin naik ke peran manajerial, Anda perlu melatih kepercayaan diri dalam mengambil keputusan.";
        }

        const html = `
            <div class="header">
                <h2>Analisis Motivasi Kepemimpinan</h2>
            </div>
            <div class="user-info">
                <strong>Nama:</strong> ${dataDiri.nama}<br>
                <strong>Usia:</strong> ${dataDiri.usia} Tahun<br>
                <strong>Tanggal Tes:</strong> ${data.x_05}
            </div>
            <div class="score-box">
                <div class="score-label">Skor Motivasi Anda</div>
                <div class="score-value">${totalSkor}</div>
                <div class="score-label" style="color: ${totalSkor >= 42 ? '#27ae60' : '#e67e22'}">${kategori}</div>
            </div>
            <div class="interpretation">
                <strong>Interpretasi:</strong><br>
                ${deskripsi}
            </div>
            <div class="chart-container">
                <canvas id="scoreChart"></canvas>
            </div>
            <p style="font-size: 12px; color: #888; text-align: center; margin-top: 20px;">
                Token: ${data.x_04}
            </p>
            <a href="javascript:window.print()" class="btn-action">Simpan Hasil (PDF)</a>
        `;

        document.getElementById('main-content').innerHTML = html;
        renderChart(totalSkor);
    }

    function renderChart(skor) {
        const ctx = document.getElementById('scoreChart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Skor Anda'],
                datasets: [{
                    label: 'Tingkat Motivasi',
                    data: [skor],
                    backgroundColor: skor >= 42 ? '#3498db' : '#e67e22',
                    borderRadius: 8
                }]
            },
            options: {
                indexAxis: 'y',
                scales: {
                    x: { min: 14, max: 70 }
                },
                plugins: {
                    legend: { display: false }
                }
            }
        });
    }
</script>

</body>
</html>