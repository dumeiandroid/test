<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hasil Tes Judging vs Perceiving</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px; 
        }
        .container { 
            max-width: 850px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        .header h1 { font-size: 2em; margin-bottom: 10px; }
        .header p { opacity: 0.9; font-size: 1.1em; }
        .content { padding: 40px; }
        .profile-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 5px solid #667eea;
        }
        .profile-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .profile-item { display: flex; flex-direction: column; }
        .profile-label {
            font-size: 0.85em;
            color: #667eea;
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        .profile-value { font-size: 1.1em; color: #2c3e50; }
        .result-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 40px;
            border-radius: 15px;
            margin: 30px 0;
            border-left: 8px solid;
            text-align: center;
        }
        .result-card h2 { font-size: 3em; margin-bottom: 15px; }
        .result-tagline { font-size: 1.4em; font-weight: bold; margin-bottom: 10px; }
        .spectrum {
            display: flex;
            align-items: center;
            gap: 20px;
            margin: 30px 0;
            background: white;
            padding: 30px;
            border-radius: 15px;
        }
        .spectrum-side { flex: 1; text-align: center; }
        .spectrum-icon { font-size: 4em; margin-bottom: 10px; }
        .spectrum-name { font-size: 1.5em; font-weight: bold; margin-bottom: 5px; }
        .spectrum-score { font-size: 2.5em; font-weight: bold; margin: 10px 0; }
        .spectrum-bar { flex: 2; position: relative; }
        .bar-container {
            height: 40px;
            background: linear-gradient(to right, #27ae60, #e67e22);
            border-radius: 20px;
            position: relative;
            overflow: hidden;
        }
        .bar-marker {
            position: absolute;
            top: -30px;
            transform: translateX(-50%);
            font-size: 2em;
        }
        .chart-container { position: relative; height: 300px; margin: 30px 0; }
        .info-section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            border: 2px solid #e9ecef;
        }
        .info-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .info-section ul { list-style: none; padding-left: 0; }
        .info-section li {
            padding: 10px 0;
            padding-left: 30px;
            position: relative;
            line-height: 1.6;
            color: #555;
        }
        .info-section li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #667eea;
            font-weight: bold;
            font-size: 1.2em;
        }
        .comparison-table {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .table-column { background: #f8f9fa; padding: 20px; border-radius: 10px; }
        .table-column h4 {
            text-align: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 3px solid;
            font-size: 1.2em;
        }
        .table-column ul { list-style: none; padding: 0; }
        .table-column li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
            color: #444;
        }
        .table-column li:before {
            content: "‚Ä¢";
            position: absolute;
            left: 5px;
            font-size: 1.5em;
        }
        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 30px;
        }
        button {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-download { background: #667eea; color: white; }
        .btn-download:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        .btn-print { background: #2c3e50; color: white; }
        .btn-print:hover { background: #1a252f; transform: translateY(-2px); }
        .error-msg { text-align: center; padding: 60px 40px; color: #e74c3c; }
        .loading { text-align: center; padding: 60px 40px; color: #7f8c8d; }
        @media print {
            body { background: white; padding: 0; }
            .button-group { display: none; }
            .container { box-shadow: none; }
        }
        @media (max-width: 600px) {
            .header h1 { font-size: 1.5em; }
            .result-card h2 { font-size: 2em; }
            .button-group { grid-template-columns: 1fr; }
            .comparison-table { grid-template-columns: 1fr; }
            .spectrum { flex-direction: column; }
        }
    </style>
</head>
<body>

<div class="container" id="mainContainer">
    <div class="loading">
        <div style="font-size: 3em; margin-bottom: 20px;">‚è≥</div>
        <h3>Memuat Hasil Tes...</h3>
    </div>
</div>

<script>
const LIFESTYLE_TYPES = {
    JUDGING: {
        name: 'JUDGING (PENILAI)',
        color: '#27ae60',
        icon: 'üìã',
        tagline: 'Terencana & Terorganisir',
        description: 'Anda menyukai struktur, perencanaan, dan keputusan yang cepat. Anda merasa nyaman dengan jadwal dan rutinitas yang jelas.',
        characteristics: [
            'Suka membuat rencana dan jadwal',
            'Terorganisir dan tertib',
            'Menyelesaikan tugas lebih awal',
            'Membuat keputusan dengan cepat',
            'Suka closure dan penyelesaian',
            'Rutinitas yang konsisten',
            'Disiplin dan tepat waktu',
            'Goal-oriented'
        ],
        strengths: [
            'Manajemen waktu baik',
            'Produktivitas tinggi',
            'Keandalan',
            'Kedisiplinan',
            'Pencapaian target'
        ],
        weaknesses: [
            'Kaku terhadap perubahan',
            'Stres jika rencana berubah',
            'Terlalu perfeksionis',
            'Kurang spontan',
            'Sulit beradaptasi'
        ],
        careers: ['Project Manager', 'Administrator', 'Accountant', 'Executive', 'Operations Manager', 'Event Planner', 'Quality Assurance'],
        tips: [
            'Belajar untuk lebih fleksibel',
            'Terima bahwa tidak semua harus sempurna',
            'Beri ruang untuk spontanitas',
            'Jangan terlalu keras pada diri sendiri',
            'Nikmati prosesnya, bukan hanya hasil'
        ]
    },
    PERCEIVING: {
        name: 'PERCEIVING (PENGAMAT)',
        color: '#e67e22',
        icon: 'üéà',
        tagline: 'Fleksibel & Spontan',
        description: 'Anda menyukai fleksibilitas, spontanitas, dan pilihan yang terbuka. Anda merasa nyaman dengan ketidakpastian dan perubahan.',
        characteristics: [
            'Fleksibel dan adaptif',
            'Spontan dan improvisasi',
            'Suka menjaga pilihan tetap terbuka',
            'Bekerja dengan deadline',
            'Santai terhadap jadwal',
            'Eksplorasi berbagai kemungkinan',
            'Multitasking',
            'Process-oriented'
        ],
        strengths: [
            'Adaptabilitas tinggi',
            'Kreativitas',
            'Keterbukaan pikiran',
            'Fleksibilitas',
            'Handle perubahan dengan baik'
        ],
        weaknesses: [
            'Prokrastinasi',
            'Kurang terorganisir',
            'Sering terlambat',
            'Sulit menyelesaikan',
            'Impulsif'
        ],
        careers: ['Creative Director', 'Entrepreneur', 'Journalist', 'Artist', 'Researcher', 'Consultant', 'Freelancer'],
        tips: [
            'Tetapkan deadline pribadi',
            'Gunakan to-do list sederhana',
            'Belajar prioritisasi',
            'Hindari prokrastinasi berlebihan',
            'Selesaikan satu hal sebelum mulai yang baru'
        ]
    }
};

async function loadData() {
    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get('token');
    const container = document.getElementById('mainContainer');

    if (!token) {
        container.innerHTML = `<div class="error-msg"><h2>‚ùå Error</h2><p>Token tidak ditemukan di URL</p></div>`;
        return;
    }

    try {
        const response = await fetch(`https://lidan-co-id.pages.dev/api/contacts_filter_dinamis6?table=tes&x_04_eq=${token}`, {
            headers: { 'X-Custom-Auth': 'admin' }
        });
        const res = await response.json();

        if (res.success && res.count > 0) {
            renderResult(res.data[0]);
        } else {
            container.innerHTML = `<div class="error-msg"><h2>‚ùå Data Tidak Ditemukan</h2><p>Token tidak valid atau sudah kadaluarsa</p></div>`;
        }
    } catch (e) {
        container.innerHTML = `<div class="error-msg"><h2>‚ùå Kesalahan Koneksi</h2><p>Tidak dapat terhubung ke server</p></div>`;
    }
}

function renderResult(data) {
    const dataDiri = JSON.parse(data.x_02 || "{}");
    const scores = JSON.parse(data.x_03 || "{}");
    
    const total = 10;
    const skorJudging = scores.A || 0;
    const skorPerceiving = scores.B || 0;
    
    const persenJudging = Math.round((skorJudging / total) * 100);
    const persenPerceiving = Math.round((skorPerceiving / total) * 100);
    
    const isJudging = skorJudging > skorPerceiving;
    const personality = isJudging ? LIFESTYLE_TYPES.JUDGING : LIFESTYLE_TYPES.PERCEIVING;
    
    const markerPosition = (skorJudging / total) * 100;

    const html = `
        <div class="header">
            <h1>üéØ Hasil Tes Gaya Hidup</h1>
            <p>Saya Termasuk Tipe Penilai atau Pengamat?</p>
        </div>
        <div class="content">
            <div class="profile-section">
                <h3 style="color: #2c3e50; margin-bottom: 15px;">üìã Informasi Peserta</h3>
                <div class="profile-grid">
                    <div class="profile-item">
                        <span class="profile-label">Nama Lengkap</span>
                        <span class="profile-value">${dataDiri.nama || '-'}</span>
                    </div>
                    <div class="profile-item">
                        <span class="profile-label">Usia</span>
                        <span class="profile-value">${dataDiri.usia || '-'} Tahun</span>
                    </div>
                    <div class="profile-item">
                        <span class="profile-label">Pendidikan</span>
                        <span class="profile-value">${dataDiri.pendidikan || '-'}</span>
                    </div>
                    <div class="profile-item">
                        <span class="profile-label">Tanggal Tes</span>
                        <span class="profile-value">${data.x_05 || '-'}</span>
                    </div>
                </div>
            </div>

            <div class="result-card" style="border-color: ${personality.color};">
                <h2 style="color: ${personality.color};">${personality.icon} ${personality.name}</h2>
                <div class="result-tagline" style="color: ${personality.color};">${personality.tagline}</div>
                <p style="font-size: 1.1em; color: #555;">${personality.description}</p>
            </div>

            <div class="spectrum">
                <div class="spectrum-side">
                    <div class="spectrum-icon">üìã</div>
                    <div class="spectrum-name" style="color: #27ae60;">Judging</div>
                    <div class="spectrum-score" style="color: #27ae60;">${persenJudging}%</div>
                    <div style="color: #666;">${skorJudging}/${total}</div>
                </div>
                
                <div class="spectrum-bar">
                    <div class="bar-marker" style="left: ${markerPosition}%;">üë§</div>
                    <div class="bar-container">
                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-weight: bold; font-size: 0.9em;">
                            Spektrum Gaya Hidup
                        </div>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-top: 10px; color: #666; font-size: 0.9em;">
                        <span>Terstruktur</span>
                        <span>Seimbang</span>
                        <span>Fleksibel</span>
                    </div>
                </div>
                
                <div class="spectrum-side">
                    <div class="spectrum-icon">üéà</div>
                    <div class="spectrum-name" style="color: #e67e22;">Perceiving</div>
                    <div class="spectrum-score" style="color: #e67e22;">${persenPerceiving}%</div>
                    <div style="color: #666;">${skorPerceiving}/${total}</div>
                </div>
            </div>

            <div class="chart-container">
                <canvas id="myChart"></canvas>
            </div>

            <div class="info-section">
                <h3>üéØ Karakteristik Anda</h3>
                <ul>
                    ${personality.characteristics.map(char => `<li>${char}</li>`).join('')}
                </ul>
            </div>

            <div class="info-section">
                <h3>üí™ Kekuatan Anda</h3>
                <ul>
                    ${personality.strengths.map(strength => `<li>${strength}</li>`).join('')}
                </ul>
            </div>

            <div class="info-section">
                <h3>‚ö†Ô∏è Area Pengembangan</h3>
                <ul>
                    ${personality.weaknesses.map(weakness => `<li>${weakness}</li>`).join('')}
                </ul>
            </div>

            <div class="info-section">
                <h3>üíº Karir yang Cocok</h3>
                <p style="color: #555; line-height: 1.8; font-size: 1.1em;">
                    ${personality.careers.join(' ‚Ä¢ ')}
                </p>
            </div>

            <div class="info-section">
                <h3>üí° Saran Pengembangan Diri</h3>
                <ul>
                    ${personality.tips.map(tip => `<li>${tip}</li>`).join('')}
                </ul>
            </div>

            <div class="info-section">
                <h3>‚öñÔ∏è Perbandingan Judging vs Perceiving</h3>
                <div class="comparison-table">
                    <div class="table-column">
                        <h4 style="color: #27ae60; border-color: #27ae60;">üìã Judging</h4>
                        <ul>
                            <li style="color: #27ae60;">Terencana</li>
                            <li style="color: #27ae60;">Terorganisir</li>
                            <li style="color: #27ae60;">Keputusan Cepat</li>
                            <li style="color: #27ae60;">Suka Closure</li>
                            <li style="color: #27ae60;">Disiplin</li>
                            <li style="color: #27ae60;">Goal-oriented</li>
                        </ul>
                    </div>
                    <div class="table-column">
                        <h4 style="color: #e67e22; border-color: #e67e22;">üéà Perceiving</h4>
                        <ul>
                            <li style="color: #e67e22;">Fleksibel</li>
                            <li style="color: #e67e22;">Spontan</li>
                            <li style="color: #e67e22;">Pilihan Terbuka</li>
                            <li style="color: #e67e22;">Eksplorasi</li>
                            <li style="color: #e67e22;">Adaptif</li>
                            <li style="color: #e67e22;">Process-oriented</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="info-section" style="background: #fff3cd; border-color: #ffc107;">
                <h3 style="color: #856404;">üìö Dalam Konteks MBTI</h3>
                <p style="color: #856404; line-height: 1.8;">
                    Dimensi Judging-Perceiving adalah dimensi ke-4 dalam Myers-Briggs Type Indicator (MBTI). 
                    Dimensi ini menggambarkan bagaimana Anda berinteraksi dengan dunia luar dan mengatur hidup Anda. 
                    Judging lebih suka keputusan dan struktur, sedangkan Perceiving lebih suka fleksibilitas dan spontanitas.
                </p>
            </div>

            <div class="button-group">
                <button class="btn-download" onclick="downloadAsImage()">üì• Download JPG</button>
                <button class="btn-print" onclick="window.print()">üñ®Ô∏è Cetak PDF</button>
            </div>
        </div>
    `;

    document.getElementById('mainContainer').innerHTML = html;
    createChart(skorJudging, skorPerceiving, persenJudging, persenPerceiving);
}

function createChart(skorJudging, skorPerceiving, persenJudging, persenPerceiving) {
    const ctx = document.getElementById('myChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Judging', 'Perceiving'],
            datasets: [{
                label: 'Skor',
                data: [skorJudging, skorPerceiving],
                backgroundColor: [
                    'rgba(39, 174, 96, 0.7)',
                    'rgba(230, 126, 34, 0.7)'
                ],
                borderColor: [
                    '#27ae60',
                    '#e67e22'
                ],
                borderWidth: 3
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const percentage = context.dataIndex === 0 ? persenJudging : persenPerceiving;
                            return `Skor: ${context.parsed.y}/10 (${percentage}%)`;
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    max: 10,
                    ticks: { stepSize: 2 }
                }
            }
        }
    });
}

async function downloadAsImage() {
    const button = event.target;
    button.disabled = true;
    button.textContent = '‚è≥ Memproses...';
    
    try {
        const container = document.getElementById('mainContainer');
        const canvas = await html2canvas(container, {
            scale: 2,
            backgroundColor: '#ffffff',
            logging: false
        });
        
        const link = document.createElement('a');
        link.download = `Hasil-Judging-Perceiving-${Date.now()}.jpg`;
        link.href = canvas.toDataURL('image/jpeg', 0.95);
        link.click();
        
        button.disabled = false;
        button.textContent = '‚úÖ Download Berhasil!';
        setTimeout(() => {
            button.textContent = 'üì• Download JPG';
        }, 2000);
    } catch (error) {
        button.disabled = false;
        button.textContent = '‚ùå Gagal';
        setTimeout(() => {
            button.textContent = 'üì• Download JPG';
        }, 2000);
    }
}

loadData();
</script>
</body>
</html>